<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InvestSim: Simulador de Juros Simples</title>
    
    <meta name="theme-color" content="#4f46e5"> 
    <link rel="manifest" href="./manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Configura√ß√£o de Fonte Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-image: linear-gradient(to bottom right, #eef2ff, #f7f9fd);
        }
        /* Estilos de transi√ß√£o para abas de navega√ß√£o principal (Introdu√ß√£o, C√°lculo, Resultados) */
        .tab-content {
            display: none;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.4s ease-out, transform 0.4s ease-out;
        }
        .tab-content.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
        /* Estilo para garantir que o formul√°rio inativo do cen√°rio n√£o seja vis√≠vel */
        .simulation-form {
            display: none;
            transition: all 0.4s ease-in-out;
        }
        .simulation-form.active {
            display: block;
        }
        /* Estilos da Tabela de Resultados */
        .results-table th {
            @apply bg-indigo-700 text-white font-extrabold;
        }
        .input-group label {
            @apply text-sm font-semibold text-gray-700 mb-2 block;
        }
        .input-group input, .input-group select {
            @apply shadow-sm transition duration-150 ease-in-out hover:border-indigo-400;
        }
        /* Estilo para a mensagem de c√≥pia */
        #copyFeedback {
            transition: opacity 0.3s ease-in-out;
            opacity: 0;
        }
        #copyFeedback.show {
            opacity: 1;
        }
        /* Estilo para os bot√µes de simula√ß√£o (Simples Geral / Imposto) */
        .simulation-selector button {
            @apply flex-grow transition duration-300 ease-in-out text-center;
        }

        /* Estilo para o select customizado (Caprichado) */
        .custom-select-wrapper {
            position: relative;
            width: 100%; 
        }
        .custom-select-wrapper select {
            /* Esconde a seta padr√£o do navegador */
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            /* Adiciona padding √† direita para a seta customizada */
            padding-right: 2.8rem; /* Espa√ßo para o √≠cone */
            background-color: white; /* Garante fundo branco para visibilidade */
        }
        /* √çcone de Seta Customizado usando SVG */
        .custom-select-wrapper::after {
            /* SVG de seta para baixo do Heroicons/Tailwind */
            content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='currentColor'%3E%3Cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd' /%3E%3Csvg%3E");
            color: #6b7280; 
            position: absolute;
            right: 0.8rem; 
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none; 
            width: 1.25rem; 
            height: 1.25rem; 
        }
    </style>
</head>
<body class="min-h-screen p-4 sm:p-8">

    <div class="container max-w-4xl mx-auto bg-white shadow-3xl rounded-3xl p-6 md:p-12 border border-indigo-100">
        
        <header class="text-center mb-10">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-indigo-900 border-b-4 border-indigo-200 inline-block pb-2 mb-2">
                InvestSim üìà
            </h1>
            <p class="text-xl text-gray-600 font-medium">Simulador de Regime de Juros Simples</p>
        </header>
        
        <div class="bg-indigo-50 border-l-4 border-indigo-500 p-4 rounded-lg mb-10 shadow-md">
            <p class="text-lg font-bold text-indigo-800">M√âTODO ZERO CHUTE</p>
            <span class="text-sm font-medium text-gray-600">PROFESSOR ANDR√â LOCATELLI</span> 
        </div>
        
        <hr class="mb-8 border-gray-200">

        <div id="tab-intro" class="tab-content active">
            <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">Bem-vindo(a) ao Simulador!</h2>
            <div class="p-6 bg-indigo-50 rounded-xl shadow-lg border border-indigo-200">
                <p class="text-xl font-semibold text-center text-indigo-800">
                    Voc√™ sabe quais tipos de opera√ß√µes financeiras s√£o regidas pelo regime de Juros Simples?
                </p>
            </div>

            <div class="flex justify-center space-x-6 mt-10">
                <button onclick="responderIntro('sim')" class="flex items-center bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-4 px-10 rounded-xl transition duration-300 shadow-xl transform hover:scale-105">
                    <span class="text-lg">‚úÖ Sim, eu sei!</span>
                </button>
                <button onclick="responderIntro('nao')" class="flex items-center bg-red-600 hover:bg-red-700 text-white font-semibold py-4 px-10 rounded-xl transition duration-300 shadow-xl transform hover:scale-105">
                    <span class="text-lg">‚ùå N√£o, me explique!</span>
                </button>
            </div>
        </div>

        <div id="tab-calculo" class="tab-content">
            <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">Configura√ß√£o da Simula√ß√£o</h2>
            <div id="mensagem-calculo" class="text-center mb-6"></div>
            
            <div id="calculo-content-wrapper" class="hidden-content">

                <p class="text-lg font-semibold text-gray-700 mb-4">Escolha o Cen√°rio para Iniciar:</p>
                <div class="simulation-selector flex gap-3 p-2 bg-gray-100 rounded-2xl mb-8 shadow-inner">
                    <button id="btn-simples-geral" class="py-4 px-4 font-bold rounded-xl bg-emerald-600 text-white shadow-lg" onclick="mostrarSimulacao('simples-geral')">
                        1. Juros Simples (Geral)
                    </button>
                    <button id="btn-atraso-imposto" class="py-4 px-4 font-bold rounded-xl bg-gray-300 hover:bg-gray-400 text-gray-800" onclick="mostrarSimulacao('atraso-imposto')">
                        2. Atraso de Imposto
                    </button>
                </div>

                <div id="simples-geral-form" class="simulation-form active bg-white border border-indigo-200 rounded-2xl p-8 shadow-2xl transition duration-300 transform hover:shadow-indigo-300/50">
                    <h3 class="text-2xl font-extrabold text-indigo-700 mb-6 border-b pb-2">Simula√ß√£o Geral de Crescimento</h3>
                    
                    <div class="grid md:grid-cols-2 gap-6 mb-6">
                        <div class="input-group">
                            <label for="valorInicial">Valor Inicial (Principal - R$):</label>
                            <input type="number" id="valorInicial" value="1000.00" min="0" step="0.01" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                        <div class="input-group custom-select-wrapper">
                            <label for="periodoTaxa">Base da Taxa:</label>
                            <select id="periodoTaxa" onchange="updateGeneralSimLabels()" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="anual">Anual</option>
                                <option value="mensal">Mensal</option>
                            </select>
                        </div>
                    </div>

                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="input-group">
                            <label id="labelTaxaGeral" for="taxaGeral">Taxa de Juros Anual (%):</label>
                            <input type="number" id="taxaGeral" value="10.00" min="0" step="0.01" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                        
                        <div class="input-group">
                            <label id="labelTempoGeral" for="tempoGeral">Tempo (Anos):</label>
                            <input type="number" id="tempoGeral" value="5" min="1" step="1" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                    </div>

                    <button onclick="calcularJurosSimples()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold text-lg py-3 mt-8 rounded-xl transition duration-300 shadow-xl transform hover:scale-[1.01]">
                        Simular Crescimento
                    </button>
                </div>
                
                <div id="atraso-imposto-form" class="simulation-form bg-white border border-red-200 rounded-2xl p-8 shadow-2xl transition duration-300 transform hover:shadow-red-300/50">
                    <h3 class="text-2xl font-extrabold text-red-700 mb-6 border-b pb-2">Simula√ß√£o de Atraso de Imposto</h3>
                    <p class="text-sm text-red-600 font-semibold mb-6">C√°lculo padr√£o: Multa Fixa (sobre o Principal) + Juros de Mora (Simples Di√°rio).</p>

                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="input-group">
                            <label for="principalImposto">Valor Original (R$):</label>
                            <input type="number" id="principalImposto" value="800.00" min="0" step="0.01" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500">
                        </div>

                        <div class="input-group">
                            <label for="multaFixa">Multa Fixa (%):</label>
                            <input type="number" id="multaFixa" value="2.00" min="0" step="0.01" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500">
                        </div>

                        <div class="input-group">
                            <label for="taxaJurosMora">Juros de Mora (% a.d.):</label>
                            <input type="number" id="taxaJurosMora" value="0.033" min="0" step="0.001" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500">
                        </div>
                        
                        <div class="input-group">
                            <label for="tempoDias">Atraso (Dias):</label>
                            <input type="number" id="tempoDias" value="10" min="1" step="1" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500">
                        </div>
                    </div>

                    <button onclick="calcularAtrasoImposto()" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold text-lg py-3 mt-8 rounded-xl transition duration-300 shadow-xl transform hover:scale-[1.01]">
                        Calcular Total Devido
                    </button>
                </div>
            </div>
        </div>

        <div id="resultados" class="tab-content">
            <h2 class="text-3xl font-bold text-gray-800 mb-8 border-b-2 pb-2 text-center">Resumo Detalhado da Simula√ß√£o</h2>
            
            <div id="tabelaCrescimento" class="bg-white p-6 rounded-2xl shadow-3xl overflow-x-auto border border-gray-100 mb-8">
                </div>
            
            <div class="flex flex-col sm:flex-row justify-between items-center mt-6 space-y-4 sm:space-y-0 sm:space-x-4">
                <button onclick="mostrarAba('tab-calculo')" class="w-full sm:w-auto bg-gray-500 hover:bg-gray-600 text-white font-semibold py-3 px-8 rounded-xl transition duration-300 shadow-md">
                    Voltar e Recalcular
                </button>
                
                <div class="flex space-x-4">
                    <button onclick="copiarResultados()" class="flex items-center bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-6 rounded-xl transition duration-300 shadow-lg transform hover:scale-105">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                        Copiar Relat√≥rio
                    </button>
                    <button onclick="baixarRelatorio()" class="flex items-center bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-3 px-6 rounded-xl transition duration-300 shadow-lg transform hover:scale-105">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                        Baixar (TXT)
                    </button>
                </div>
            </div>

            <div id="copyFeedback" class="mt-6 text-center text-base font-semibold text-green-700 bg-green-100 p-3 rounded-lg border border-green-300 shadow-inner" aria-live="polite">
                Resultados copiados para a √°rea de transfer√™ncia!
            </div>

        </div>

    </div>

    <script>
        // Vari√°vel global para armazenar o conte√∫do do relat√≥rio gerado
        let relatorioContent = '';

        function formatarMoeda(valor) {
            return 'R$ ' + valor.toFixed(2).replace('.', ',');
        }

        // Fun√ß√£o para gerenciar a navega√ß√£o entre as abas principais
        function mostrarAba(idDaAba) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById(idDaAba).classList.add('active');
            document.getElementById('copyFeedback').classList.remove('show');
        }

        /**
         * Alterna entre os formul√°rios de Juros Simples Geral e Atraso de Imposto.
         * Controla a classe 'active' para mostrar/esconder o formul√°rio e estiliza o bot√£o.
         */
        function mostrarSimulacao(idSimulacao) {
            const forms = document.querySelectorAll('.simulation-form');
            
            // 1. Esconder todos os formul√°rios
            forms.forEach(form => {
                form.classList.remove('active');
            });

            const buttons = document.querySelectorAll('.simulation-selector button');
            
            // 2. Desativar o estilo de todos os bot√µes (cinza)
            buttons.forEach(btn => {
                btn.classList.remove('bg-emerald-600', 'text-white', 'shadow-lg');
                btn.classList.add('bg-gray-300', 'hover:bg-gray-400', 'text-gray-800');
            });
            
            // 3. Ativar o formul√°rio e o bot√£o clicado
            const activeBtn = document.getElementById(`btn-${idSimulacao}`);
            const activeForm = document.getElementById(`${idSimulacao}-form`);

            if (activeBtn) {
                activeBtn.classList.remove('bg-gray-300', 'hover:bg-gray-400', 'text-gray-800');
                activeBtn.classList.add('bg-emerald-600', 'text-white', 'shadow-lg');
            }

            if (activeForm) {
                activeForm.classList.add('active'); 
                if (idSimulacao === 'simples-geral') {
                    updateGeneralSimLabels();
                }
            }

            document.getElementById('tabelaCrescimento').innerHTML = '';
        }

        /**
         * Atualiza os r√≥tulos de Taxa e Tempo na Simula√ß√£o Geral.
         */
        function updateGeneralSimLabels() {
            const periodo = document.getElementById('periodoTaxa').value;
            const labelTaxa = document.getElementById('labelTaxaGeral');
            const labelTempo = document.getElementById('labelTempoGeral');
            
            if (periodo === 'anual') {
                labelTaxa.textContent = 'Taxa de Juros Anual (%):';
                labelTempo.textContent = 'Tempo (Anos):';
            } else { // mensal
                labelTaxa.textContent = 'Taxa de Juros Mensal (%):';
                labelTempo.textContent = 'Tempo (Meses):';
            }
        }
        
        function iniciarSimulacao() {
            document.getElementById('mensagem-calculo').innerHTML = '<span class="text-xl font-medium text-indigo-700">üéØ √ìtimo! Insira os dados nos campos abaixo.</span>';
            document.getElementById('calculo-content-wrapper').classList.remove('hidden-content');
            mostrarAba('tab-calculo');
            mostrarSimulacao('simples-geral'); 
        }

        function responderIntro(resposta) {
            const mensagemCalculo = document.getElementById('mensagem-calculo');
            const wrapperCalculo = document.getElementById('calculo-content-wrapper');
            
            if (resposta === 'sim') {
                mensagemCalculo.innerHTML = '<span class="text-xl font-medium text-indigo-700">üéØ Parab√©ns! Insira os dados nos campos abaixo.</span>';
                wrapperCalculo.classList.remove('hidden-content');
                mostrarAba('tab-calculo');
                mostrarSimulacao('simples-geral'); 
            } else {
                wrapperCalculo.classList.add('hidden-content');

                mensagemCalculo.innerHTML = `
                    <div class="bg-blue-50 border-l-4 border-blue-500 text-blue-800 p-5 rounded-lg shadow-md mb-8">
                        <h4 class="font-bold text-xl mb-3">üí° Onde o Juros Simples √© aplicado?</h4>
                        <p class="text-base mb-3">O Juros Simples n√£o √© comum em grandes investimentos, mas √© crucial para:</p>
                        <ul class="list-disc list-inside ml-4 space-y-2 text-base">
                            <li>**C√°lculo de Multas e Juros de Mora:** Em atrasos de contas, impostos (como no Cen√°rio 2) e d√≠vidas de curt√≠ssimo prazo.</li>
                            <li>**Opera√ß√µes de Desconto:** Troca de cheques ou promiss√≥rias em curt√≠ssimo prazo.</li>
                        </ul>
                        <p class="mt-4 font-semibold">‚û°Ô∏è Clique em **Prosseguir** e comece a simular para ver o impacto real.</p>
                        <button onclick="iniciarSimulacao()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 mt-4 rounded-xl transition duration-300 shadow-lg">
                            Prosseguir para a Simula√ß√£o
                        </button>
                    </div>
                `;
                mostrarAba('tab-calculo');
            }
        }

        // =========================================================================
        // FUN√á√ÉO DE C√ÅLCULO 1: JUROS SIMPLES GERAL
        // =========================================================================
        function calcularJurosSimples() {
            const periodo = document.getElementById('periodoTaxa').value; 
            const unidadeTempo = periodo === 'anual' ? 'Ano' : 'M√™s';

            const P = parseFloat(document.getElementById('valorInicial').value);
            const i_percentual = parseFloat(document.getElementById('taxaGeral').value); 
            const i = i_percentual / 100;
            const t_total = parseInt(document.getElementById('tempoGeral').value); 

            if (isNaN(P) || isNaN(i) || isNaN(t_total) || P < 0 || i < 0 || t_total < 1) {
                document.getElementById('tabelaCrescimento').innerHTML = '<p class="text-red-600 font-semibold p-4">‚ö†Ô∏è Por favor, insira valores v√°lidos e positivos (Principal, Taxa e Tempo) para a simula√ß√£o.</p>';
                mostrarAba('resultados');
                return;
            }

            // Gera√ß√£o da Tabela HTML
            let tabelaHTML = '<table class="w-full results-table text-left border-collapse">';
            tabelaHTML += `<thead><tr><th class="p-4 rounded-tl-xl">${unidadeTempo}</th><th class="p-4">Juros Acumulados (R$)</th><th class="p-4 rounded-tr-xl">Montante Final (R$)</th></tr></thead>`;
            tabelaHTML += '<tbody>';
            
            // Gera√ß√£o do Conte√∫do do Relat√≥rio de Texto (.txt)
            let relatorioTexto = `RELAT√ìRIO DE SIMULA√á√ÉO - JUROS SIMPLES GERAL\n`;
            relatorioTexto += `=================================================\n`;
            relatorioTexto += `Data: ${new Date().toLocaleDateString('pt-BR')}\n`;
            relatorioTexto += `Professor: Andr√© Locatelli\n\n`;
            relatorioTexto += `PAR√ÇMETROS:\n`;
            relatorioTexto += `  Principal (P): ${formatarMoeda(P)}\n`;
            relatorioTexto += `  Taxa de Juros (i): ${i_percentual}% ${periodo}\n`;
            relatorioTexto += `  Tempo (t): ${t_total} ${unidadeTempo}(s)\n\n`;
            relatorioTexto += `EVOLU√á√ÉO DOS RESULTADOS:\n`;
            relatorioTexto += `  Per√≠odo | Juros Acumulados | Montante\n`;
            relatorioTexto += `  --------|------------------|----------\n`;
            relatorioTexto += `  0       | R$ 0,00          | ${formatarMoeda(P)}\n`;
            
            for (let t = 1; t <= t_total; t++) {
                const jurosAcumulados = P * i * t;
                const montanteAtual = P + jurosAcumulados;

                const rowClass = t % 2 === 0 ? 'bg-gray-50' : 'bg-white';

                tabelaHTML += `
                    <tr class="${rowClass} hover:bg-indigo-50 border-b border-gray-200">
                        <td class="p-4 text-center font-medium">${t}</td>
                        <td class="p-4 text-emerald-600 font-medium">${formatarMoeda(jurosAcumulados)}</td>
                        <td class="p-4 font-bold">${formatarMoeda(montanteAtual)}</td>
                    </tr>
                `;
                relatorioTexto += `  ${String(t).padEnd(7)} | ${formatarMoeda(jurosAcumulados).padEnd(16)} | ${formatarMoeda(montanteAtual)}\n`;
            }

            tabelaHTML += '</tbody></table>';

            // Resumo Final
            const jurosTotal = P * i * t_total;
            const montanteFinal = P + jurosTotal;
            const textoTempoFinal = t_total === 1 ? unidadeTempo : `${t_total} ${unidadeTempo}s`;

            const resumoHTML = `
                <h3 class="text-2xl font-bold text-indigo-700 mb-4">Cen√°rio 1: Juros Simples (Crescimento)</h3>
                <div class="bg-emerald-50 text-emerald-800 p-5 rounded-xl font-bold mb-6 text-center shadow-md border border-emerald-300">
                    <p>O Investimento de **${formatarMoeda(P)}** a uma taxa de **${i_percentual}% ${periodo}** por **${textoTempoFinal}** rendeu um total de:</p>
                    <p class="text-3xl mt-2">**${formatarMoeda(montanteFinal)}** (Montante Final)</p>
                </div>
            `;
            
            relatorioTexto += `\nRESULTADO FINAL:\n`;
            relatorioTexto += `  Juros Totais: ${formatarMoeda(jurosTotal)}\n`;
            relatorioTexto += `  Montante Final: ${formatarMoeda(montanteFinal)}\n`;
            relatorioTexto += `=================================================\n`;
            relatorioTexto += `Simula√ß√£o gerada pelo InvestSim.`;

            document.getElementById('tabelaCrescimento').innerHTML = resumoHTML + tabelaHTML;
            relatorioContent = relatorioTexto; // Armazena o relat√≥rio para c√≥pia/download
            mostrarAba('resultados');
        }

        // =========================================================================
        // FUN√á√ÉO DE C√ÅLCULO 2: ATRASO DE IMPOSTO (Multa + Juros de Mora)
        // =========================================================================
        function calcularAtrasoImposto() {
            const P = parseFloat(document.getElementById('principalImposto').value);
            const multaPercentual = parseFloat(document.getElementById('multaFixa').value);
            const i_mora_percentual = parseFloat(document.getElementById('taxaJurosMora').value);
            const t_dias = parseInt(document.getElementById('tempoDias').value);

            const multaFixa = P * (multaPercentual / 100);
            const i_mora = i_mora_percentual / 100;

            if (isNaN(P) || isNaN(multaPercentual) || isNaN(i_mora_percentual) || isNaN(t_dias) || P < 0 || t_dias < 1) {
                document.getElementById('tabelaCrescimento').innerHTML = '<p class="text-red-600 font-semibold p-4">‚ö†Ô∏è Por favor, insira valores v√°lidos e positivos para a simula√ß√£o de atraso.</p>';
                mostrarAba('resultados');
                return;
            }

            const jurosDeMora = P * i_mora * t_dias;
            const totalDevido = P + multaFixa + jurosDeMora;

            // Gera√ß√£o da Tabela HTML
            let tabelaHTML = '<table class="w-full results-table text-left border-collapse">';
            tabelaHTML += '<thead><tr><th class="p-4 rounded-tl-xl">Componente da D√≠vida</th><th class="p-4">Valor (R$)</th><th class="p-4 rounded-tr-xl">Base de C√°lculo</th></tr></thead>';
            tabelaHTML += '<tbody>';
            
            tabelaHTML += `<tr class="bg-white hover:bg-gray-50 border-b border-gray-200"><td>Principal Original</td><td class="p-4 font-medium">${formatarMoeda(P)}</td><td>Valor base</td></tr>`;
            tabelaHTML += `<tr class="bg-yellow-50 hover:bg-yellow-100 border-b border-gray-200 text-red-600"><td>Multa Fixa (${multaPercentual}%)</td><td class="p-4 font-medium">${formatarMoeda(multaFixa)}</td><td>${formatarMoeda(P)} * ${multaPercentual}%</td></tr>`;
            tabelaHTML += `<tr class="bg-red-50 hover:bg-red-100 border-b border-gray-200 text-red-700"><td>Juros de Mora (Simples)</td><td class="p-4 font-medium">${formatarMoeda(jurosDeMora)}</td><td>${formatarMoeda(P)} * ${i_mora_percentual}% a.d. * ${t_dias} dias</td></tr>`;

            tabelaHTML += `
                <tr class="font-bold bg-red-600 text-white shadow-xl hover:bg-red-700">
                    <td class="p-4 text-lg rounded-bl-xl">TOTAL DEVIDO</td>
                    <td class="p-4 text-lg">${formatarMoeda(totalDevido)}</td>
                    <td class="p-4 text-sm rounded-br-xl">P + Multa + Juros de Mora</td>
                </tr>
            `;

            tabelaHTML += '</tbody></table>';

            // Gera√ß√£o do Conte√∫do do Relat√≥rio de Texto (.txt)
            let relatorioTexto = `RELAT√ìRIO DE SIMULA√á√ÉO - ATRASO DE IMPOSTO\n`;
            relatorioTexto += `=================================================\n`;
            relatorioTexto += `Data: ${new Date().toLocaleDateString('pt-BR')}\n`;
            relatorioTexto += `Professor: Andr√© Locatelli\n\n`;
            relatorioTexto += `PAR√ÇMETROS DA D√çVIDA:\n`;
            relatorioTexto += `  Principal Original: ${formatarMoeda(P)}\n`;
            relatorioTexto += `  Multa Fixa: ${multaPercentual}%\n`;
            relatorioTexto += `  Juros de Mora Di√°rios (i): ${i_mora_percentual}% a.d.\n`;
            relatorioTexto += `  Tempo de Atraso (t): ${t_dias} dias\n\n`;
            relatorioTexto += `C√ÅLCULO DOS ENCARGOS:\n`;
            relatorioTexto += `  Multa Fixa: ${formatarMoeda(multaFixa)}\n`;
            relatorioTexto += `  Juros de Mora (R$ ${formatarMoeda(P)} * ${i_mora_percentual}% * ${t_dias} dias): ${formatarMoeda(jurosDeMora)}\n\n`;
            relatorioTexto += `RESULTADO FINAL:\n`;
            relatorioTexto += `  TOTAL DEVIDO: ${formatarMoeda(totalDevido)}\n`;
            relatorioTexto += `=================================================\n`;
            relatorioTexto += `Simula√ß√£o gerada pelo InvestSim.`;

            const resumoHTML = `
                <h3 class="text-2xl font-bold text-red-700 mb-4">Cen√°rio 2: Penalidade por Atraso</h3>
                <div class="bg-red-100 text-red-800 p-5 rounded-xl font-bold mb-6 text-center shadow-md border border-red-300">
                    <p>O atraso de **${t_dias} dias** no valor de **${formatarMoeda(P)}** resultou em um valor total de:</p>
                    <p class="text-3xl mt-2">**${formatarMoeda(totalDevido)}** (Total Devido)</p>
                </div>
            `;
            
            document.getElementById('tabelaCrescimento').innerHTML = resumoHTML + tabelaHTML;
            relatorioContent = relatorioTexto; // Armazena o relat√≥rio para c√≥pia/download
            mostrarAba('resultados');
        }

        // =========================================================================
        // FUN√á√ïES DE A√á√ÉO (COPIAR E BAIXAR)
        // =========================================================================

        /**
         * Copia o conte√∫do do relat√≥rio usando a API moderna navigator.clipboard.
         */
        function copiarResultados() {
            if (!relatorioContent) {
                mostrarFeedback('Nenhum resultado para copiar. Execute uma simula√ß√£o primeiro.', 'red');
                return;
            }

            if (navigator.clipboard && window.isSecureContext) {
                // Usa a API moderna e recomendada
                navigator.clipboard.writeText(relatorioContent).then(() => {
                    mostrarFeedback('Resultados copiados para a √°rea de transfer√™ncia!', 'green');
                }).catch(err => {
                    // Fallback para o m√©todo tradicional se a API falhar
                    console.error('Falha ao copiar usando navigator.clipboard: ', err);
                    copiarFallback();
                });
            } else {
                // Fallback para ambientes n√£o seguros ou navegadores antigos
                copiarFallback();
            }
        }

        function copiarFallback() {
             const tempTextArea = document.createElement('textarea');
             tempTextArea.value = relatorioContent;
             tempTextArea.style.position = 'fixed'; // Evita quebra de layout
             tempTextArea.style.left = '-9999px';
             document.body.appendChild(tempTextArea);
             tempTextArea.select();
             
             try {
                 document.execCommand('copy');
                 mostrarFeedback('Resultados copiados (M√©todo de Fallback)!', 'green');
             } catch (err) {
                 mostrarFeedback('Erro ao copiar. Tente selecionar o texto manualmente.', 'red');
                 console.error('Failed to copy text: ', err);
             } finally {
                 document.body.removeChild(tempTextArea);
             }
        }

        /**
         * Baixa o conte√∫do do relat√≥rio como um arquivo .txt.
         */
        function baixarRelatorio() {
            if (!relatorioContent) {
                mostrarFeedback('Nenhum relat√≥rio para baixar. Execute uma simula√ß√£o primeiro.', 'red');
                return;
            }
            
            const filename = `Relatorio_InvestSim_${new Date().toISOString().slice(0, 10)}.txt`;
            
            // Tipo MIME para TXT
            const txtMimeType = 'text/plain';
            const blob = new Blob([relatorioContent], { type: `${txtMimeType};charset=utf-8` });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            mostrarFeedback('Relat√≥rio (.TXT) baixado com sucesso!', 'blue');
        }

        /**
         * Exibe uma mensagem de feedback tempor√°ria.
         */
        let feedbackTimeout;
        function mostrarFeedback(message, color) {
            const feedback = document.getElementById('copyFeedback');
            
            clearTimeout(feedbackTimeout);
            
            // Define o estilo base e a mensagem
            feedback.textContent = message;
            feedback.className = `mt-6 text-center text-base font-semibold p-3 rounded-xl border shadow-inner show`;

            if (color === 'green') {
                feedback.classList.add('text-green-700', 'bg-green-100', 'border-green-300');
            } else if (color === 'red') {
                feedback.classList.add('text-red-700', 'bg-red-100', 'border-red-300');
            } else if (color === 'blue') {
                feedback.classList.add('text-blue-700', 'bg-blue-100', 'border-blue-300');
            }

            // Define o timeout para esconder a mensagem
            feedbackTimeout = setTimeout(() => {
                feedback.classList.remove('show');
            }, 3000);
        }


        // Inicia mostrando apenas a primeira aba ao carregar
        window.onload = () => {
            mostrarAba('tab-intro');
            updateGeneralSimLabels(); // Inicializa os labels corretamente
        }
    </script>

    <script>
        // Este script registra o service worker (service-worker.js)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // Caminho corrigido para ./service-worker.js
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker registrado com sucesso:', registration.scope);
                    })
                    .catch(err => {
                        console.log('Falha no registro do ServiceWorker:', err);
                    });
            });
        }
    </script>
    </body>
</html>